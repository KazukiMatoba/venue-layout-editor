version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "=== Environment Info ==="
        - node --version
        - npm --version
        - echo "=== Current directory ==="
        - pwd
        - echo "=== Directory contents ==="
        - ls -la
        - echo "=== Checking for src and public directories ==="
        - ls -la src/ || echo "src directory not found"
        - ls -la public/ || echo "public directory not found"
        - echo "=== Installing dependencies ==="
        - npm install --include=dev
        - echo "=== Dependencies installed ==="
        - echo "=== Checking installed packages ==="
        - npm list --depth=0
    build:
      commands:
        - echo "=== Starting build process ==="
        - echo "=== Checking if vite is available ==="
        - npx vite --version || echo "vite not found"
        - npm run lint || true
        - echo "=== Running build command ==="
        - CI=false npm run build
        - echo "=== Build completed ==="
        - ls -la dist/
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
  runtime:
    nodejs:
      version: 20
env:
  variables:
    CI: false
    NODE_ENV: development
    NODE_OPTIONS: "--max-old-space-size=4096"
    _LIVE_UPDATES: '[{"name":"Node.js","pkg":"node","type":"nvm","version":"20"}]'